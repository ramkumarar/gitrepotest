@startuml

' hide the spot
hide circle

' avoid problems with angled crows feet
skinparam linetype ortho

entity "event-type" as et01 {
  *id : number <<generated>>  --
  *name : text
  expire_time_minutes: number
  description : text
  created_by: text
  created_at: timestamp
  updated_at: timestamp
}

entity "channel-type" as et02 {
  *id : number <<generated>>  --
  *name : text
  active: boolean
  description : text
  created_by: text
  created_at: timestamp
  updated_at: timestamp
}


entity "message-template" as et03 {
  *id : number <<generated>>  --
  type: text
  template-format : blob
  version: number
  description : text
  created_by: text
  created_at: timestamp
  updated_at: timestamp
}

entity "event" as e01 {
  *id : number <<generated>>  --
  *event_type_id : number <<FK>>
  entity_id: text
  entity_attributes : blob
  actor_id: text
  priority: int
  created_at: timestamp
  updated_at: timestamp
}

entity "event-subscriber" as e02 {
  *id : number <<generated>>  
  *event_id : text --
  *event_subscriber_id : text <<FK>>
}

entity "user-channel-preference" as e03 {
  *id : number <<generated>>  
  *composite-user-id: text
  *channel_id : text <<FK>>
   user-settings: blob
   created_at: timestamp
  updated_at: timestamp
}

entity "event-message-template" as e04 {
  *id : number <<generated>>  
  *event_type_id : number <<FK>>
  *message_template_id : number <<FK>>
  *channel_type_id : number <<FK>>
}

entity "event-message-queue" as e05 {
  *id : number <<generated>>  
  *event_id : number <<FK>>
  *channel_type_id : number <<FK>>
  *event_text : text
  created_at: timestamp
  updated_at: timestamp
}




et01 ||..o{ e01
e01 ||..o{ e02
e03 }|--|{ et02
e02 ||..|| e03
e04 ||..|| et03
et02 ||..|{ e04
et01 ||..|{ e04
e01 ||..|| e05





@enduml
